<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rating Form</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <style>
        /* Custom styles for the rating stars */
        .stars {
            display: inline-block;
        }
        .stars input {
            display: none;
        }
        .stars label {
            font-size: 30px;
            color: #aaa;
            cursor: pointer;
        }
        .stars label:hover,
        .stars label:hover ~ label,
        .stars input:checked ~ label {
            color: #ffcc00;
        }
        #star1:checked ~ label:nth-child(1),
        #star2:checked ~ label:nth-child(2),
        #star3:checked ~ label:nth-child(3),
        #star4:checked ~ label:nth-child(4),
        #star5:checked ~ label:nth-child(5) {
            color: #ffcc00;
        }
        .footer {
            background-color: #0d47a1;
            color: white;
            text-align: center;
            padding: 20px;
            position: fixed;
            width: 100%;
            bottom: 0;
        }
        .nav-wrapper {
            background-color: #0d47a1; /* Bank of Kigali blue */
        }
        .navbar-brand img {
            height: 40px;
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <img src="/static/images/1680506194279.ico" alt="Queuequell Logo"> <!-- Replace 'logo.png' with the path to your logo image -->
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/}">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/service-we-offer}">Services We Offer</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Bank&Admin Portal
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <li><a class="dropdown-item" th:href="@{/bank-manager/bank_manager_login}">Bank Manager</a></li>
                        <li><a class="dropdown-item" th:href="@{/admin/admin_login}">Sys Admin</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/about}">About</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Rate Our Service ðŸ˜Š</h3>
        <!-- Add a button to read ratings -->
        <a th:href="@{/view_ratings}"  class="btn btn-secondary">Read Ratings</a>
    </div>

    <form id="ratingForm" th:action="@{/submitRating}" method="post">
        <div class="mb-3">
            <label for="kglBranches" class="form-label">KGL Branches</label>
            <select id="kglBranches" name="branchId" class="form-select" required onchange="fetchOfferedServices()">
                <option value="" disabled selected>Choose KGL Branches</option>
                <option th:each="branch : ${branches}" th:value="${branch.id}" th:text="${branch.bkBranchName}"></option>
            </select>
        </div>
        <div class="mb-3">
            <label for="branchOfferedServices" class="form-label">Branch Offered Services</label>
            <select id="branchOfferedServices" name="serviceId" class="form-select" required>
                <option value="" disabled selected>Choose Branch Offered Services</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="comment" class="form-label">Comment</label>
            <textarea id="comment" name="comment" class="form-control" rows="3" required></textarea>
        </div>
        <div class="mb-3">
            <p class="stars">
                <input type="radio" id="star5" name="ratingValue" value="5">
                <label for="star5">â˜†</label>
                <input type="radio" id="star4" name="ratingValue" value="4">
                <label for="star4">â˜†</label>
                <input type="radio" id="star3" name="ratingValue" value="3">
                <label for="star3">â˜†</label>
                <input type="radio" id="star2" name="ratingValue" value="2">
                <label for="star2">â˜†</label>
                <input type="radio" id="star1" name="ratingValue" value="1">
                <label for="star1">â˜†</label>
            </p>
        </div>
        <button class="btn btn-primary" type="submit">Submit Rating</button>
    </form>
</div>

<!-- Footer -->
<footer class="footer">
    <p>&copy; 2024 KABANZA SHEMA TONNY (AUCA UNIVERSITY). All rights reserved.</p>
</footer>

<!-- Bootstrap JavaScript -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
<script>
    function fetchOfferedServices() {
        var branchId = document.getElementById("kglBranches").value;
        if (branchId) {
            $.ajax({
                url: "/getOfferedServices",
                type: "POST",
                data: { branchId: branchId },
                success: function(response) {
                    var dropdown = document.getElementById("branchOfferedServices");
                    dropdown.innerHTML = ""; // Clear existing options
                    if (response && response.length > 0) {
                        response.forEach(function(service) {
                            var option = document.createElement("option");
                            option.value = service.id;
                            option.text = service.name;
                            dropdown.appendChild(option);
                        });
                    } else {
                        var defaultOption = document.createElement("option");
                        defaultOption.text = "No offered services available";
                        defaultOption.disabled = true;
                        dropdown.appendChild(defaultOption);
                    }
                    // Trigger Bootstrap update
                    var dropdownInstance = new bootstrap.Dropdown(dropdown);
                },
                error: function(xhr) {
                    console.error("Error fetching offered services:", xhr.responseText);
                }
            });
        }
    }
</script>

</body>
</html>
